#!/usr/bin/env python3

# (c) 2017 Stany MARCEL
# SPDX-License-Identifier: MIT

# Quick and Dirty tool used to decode amiibo content
#
# can be chained with amiitool:
# amiitool -k keys.bin -d -i amiibo.bin | ./amiidecode.py -k keys.bin

import struct
import hashlib
import hmac

def print_data(name, data, offset, length, comment=None):
    print('{:04X}:{:04X}(len:{:3d})'.format(offset, offset+length-1, length), name,
          ' '.join(['{:02X}'.format(x) for x in data[offset:offset+length]]), end='')
    if comment:
        print(' #', comment)
    else:
        print('')

def print_bdec(name, data, offset, length, decode):
    print('{:04X}:{:04X}(len:{:3d})'.format(offset, offset+length-1, length), name,
          data[offset:offset+length].decode(decode, errors='ignore'), '|',
          ' '.join(['{:02X}'.format(x) for x in data[offset:offset+length]]))

def print_sfmt(name, data, offset, length, fmt):
    print('{:04X}:{:04X}(len:{:3d})'.format(offset, offset+length-1, length), name,
          ' '.join([str(x) for x in struct.unpack(fmt, data[offset:offset+length])]))


def print_fmap(name, data, offset, length, fmt, datamap):
    val = struct.unpack(fmt, data[offset:offset+length])[0]
    dec = datamap.get(val, 'UNKNOWN')

    print('{:04X}:{:04X}(len:{:3d})'.format(offset, offset+length-1, length), name, dec, '|',
          ' '.join(['{:02X}'.format(x) for x in data[offset:offset+length]]),)

def print_date(name, data, offset):
    val = struct.unpack('>H', data[offset:offset+2])[0]
    day = val & 0b11111
    month = (val >> 5) & 0b1111
    year  = 2000 + ((val >> 9) & 0b1111111)
    print('{:04X}:{:04X}(len:{:3d})'.format(offset, offset+2-1, 2), name,
          '{:04d}-{:02d}-{:02d}'.format(year, month, day), '|',
          ' '.join(['{:02X}'.format(x) for x in data[offset:offset+2]]),)


def drbg(hmac_key, seed, outputsize):

    NFC3D_DRBG_OUTPUT_SIZE = 32

    hmac_iter = 0
    drbg_buffer = bytearray(b'\x00'*2 + seed)

    output = b''
    while (outputsize > 0):
        drbg_buffer[0] = 0xFF & (hmac_iter >> 8)
        drbg_buffer[1] = 0xFF & (hmac_iter >> 0)
        hmac_iter = hmac_iter + 1

        digest = hmac.new(key=hmac_key,
                          msg=bytes(drbg_buffer),
                          digestmod=hashlib.sha256).digest()
        output = output + digest[0:min(outputsize, NFC3D_DRBG_OUTPUT_SIZE)]
        outputsize = outputsize - NFC3D_DRBG_OUTPUT_SIZE

    return output


def amii_seed(data):
    seed = (data[0x29:0x29+0x02] +
            b'\x00' * 0x0E +
            data[0x1D4:0x1D4+0x08] +
            data[0x1D4:0x1D4+0x08] +
            data[0x1E8:0x1E8+0x20])
    return seed


def amii_keygen(seed, key):
    key_hmac_key = key[0:16]
    key_type_string = key[16:16+14]
    #key_rfu = key[16+14]
    key_magic_bytes_size = key[16+14+1]
    key_magic_bytes = key[16+14+1+1:
                          16+14+1+1+key_magic_bytes_size]
    key_xor_pad = key[16+14+1+1+16:
                      16+14+1+1+16+32]

    #uint8_t hmacKey[16];
    #char typeString[14];
    #uint8_t rfu;
    #uint8_t magicBytesSize;
    #uint8_t magicBytes[16];
    #uint8_t xorPad[32];

    newseed = bytearray(key_type_string +
               seed[0:16-key_magic_bytes_size] +
               key_magic_bytes +
               seed[0x10:0x10+16] +
               b'\x00'*32)

    size = len(newseed)-32
    for i in range(32):
        newseed[size+i] = seed[32+i] ^ key_xor_pad[i]

    return drbg(hmac_key=key_hmac_key, seed=newseed, outputsize=3*16)

SERNAME_MAP = {
    0x0002: "Super Smash Bros",
    0x0102: "Mario",
    0x0202: "Chibi-Robo",
    0x0302: "Yoshi's Woolly World",
    0x0402: "Splatoon",
    0x0502: "Animal Crossing",
    0x0602: "30th Anniversary Mario",
    0x0702: "Skylanders SuperChargers",
    0x0902: "The Legend of Zelda",
    0x0A02: "Shovel Knight",
    0x0C02: "Kirby",
    0x0D02: "Pokkén Tournament",
    0x0F02: "Monster Hunter Stories",
}

ID_MAP = {
    0x0000: "Mario (SSB)",
    0x0001: "Peach (SSB)",
    0x0002: "Yoshi (SSB)",
    0x0003: "Donkey Kong (SSB)",
    0x0004: "Link (SSB)",
    0x0005: "Fox (SSB)",
    0x0006: "Samus (SSB)",
    0x0007: "Wii Fit Trainer (SSB)",
    0x0008: "Villager (SSB)",
    0x0009: "Pikachu (SSB)",
    0x000A: "Kirby (SSB)",
    0x000B: "Marth (SSB)",
    0x000C: "Luigi (SSB)",
    0x000D: "Diddy Kong (SSB)",
    0x000E: "Zelda (SSB)",
    0x000F: "Little Mac (SSB)",
    0x0010: "Pit (SSB)",
    0x0011: "Lucario (SSB)",
    0x0012: "Captain Falcon (SSB)",
    0x0013: "Rosalina and Luma (SSB)",
    0x0014: "Bowser (SSB)",
    0x0015: "Bowser Jr. (SSB)",
    0x0016: "Toon Link (SSB)",
    0x0017: "Sheik (SSB)",
    0x0018: "Ike (SSB)",
    0x0019: "Dr. Mario (SSB)",
    0x001A: "Wario (SSB)",
    0x001B: "Ganondorf (SSB)",
    0x001C: "Falco (SSB)",
    0x001D: "Zero Suit Samus (SSB)",
    0x001E: "Olimar (SSB)",
    0x001F: "Palutena (SSB)",
    0x0020: "Dark Pit (SSB)",
    0x0021: "Mii Brawler (SSB)",
    0x0022: "Mii Swordfighter (SSB)",
    0x0023: "Mii Gunner (SSB)",
    0x0024: "Charizard (SSB)",
    0x0025: "Greninja (SSB)",
    0x0026: "Jigglypuff (SSB)",
    0x0027: "Meta Knight (SSB)",
    0x0028: "King Dedede (SSB)",
    0x0029: "Lucina (SSB)",
    0x002A: "Robin (SSB)",
    0x002B: "Shulk (SSB)",
    0x002C: "Ness (SSB)",
    0x002D: "Mr. Game & Watch (SSB)",
    0x002E: "R.O.B. (Famicom) (SSB)",
    0x002F: "Duck Hunt (SSB)",
    0x0030: "Sonic (SSB)",
    0x0031: "Mega Man (SSB)",
    0x0032: "Pac-Man (SSB)",
    0x0033: "R.O.B. (NES) (SSB)",
    0x0034: "Mario (SMB)",
    0x0035: "Luigi (SMB)",
    0x0036: "Peach (SMB)",
    0x0037: "Yoshi (SMB)",
    0x0038: "Toad (SMB)",
    0x0039: "Bowser (SMB)",
    0x003A: "Chibi-Robo (CHI)",
    0x003C: "Mario (Gold Edition) (SMB)",
    0x003D: "Mario (Silver Edition) (SMB)",
    0x003E: "Inkling Girl (SPL)",
    0x003F: "Inkling Boy (SPL)",
    0x0040: "Inkling Squid (SPL)",
    0x0041: "Green Yarn Yoshi (YWW)",
    0x0042: "Pink Yarn Yoshi (YWW)",
    0x0043: "Light-Blue Yarn Yoshi (YWW)",
    0x0044: "Isabelle (ACC1)",
    0x0045: "Tom Nook (ACC1)",
    0x0046: "DJ K.K. (ACC1)",
    0x0047: "Sable (ACC1)",
    0x0048: "Kappn (ACC1)",
    0x0049: "Resetti (ACC1)",
    0x004A: "Joan (ACC1)",
    0x004B: "Timmy (ACC1)",
    0x004C: "Digby (ACC1)",
    0x004D: "Pascal (ACC1)",
    0x004E: "Harriet (ACC1)",
    0x004F: "Redd (ACC1)",
    0x0050: "Saharah (ACC1)",
    0x0051: "Luna (ACC1)",
    0x0052: "Tortimer (ACC1)",
    0x0053: "Lyle (ACC1)",
    0x0054: "Lottie (ACC1)",
    0x0055: "Bob (ACC1)",
    0x0056: "Fauna (ACC1)",
    0x0057: "Curt (ACC1)",
    0x0058: "Portia (ACC1)",
    0x0059: "Leonardo (ACC1)",
    0x005A: "Cheri (ACC1)",
    0x005B: "Kyle (ACC1)",
    0x005C: "Al (ACC1)",
    0x005D: "Renée (ACC1)",
    0x005E: "Lopez (ACC1)",
    0x005F: "Jambette (ACC1)",
    0x0060: "Rasher (ACC1)",
    0x0061: "Tiffany (ACC1)",
    0x0062: "Sheldon (ACC1)",
    0x0063: "Bluebear (ACC1)",
    0x0064: "Bill (ACC1)",
    0x0065: "Kiki (ACC1)",
    0x0066: "Deli (ACC1)",
    0x0067: "Alli (ACC1)",
    0x0068: "Kabuki (ACC1)",
    0x0069: "Patty (ACC1)",
    0x006A: "Jitters (ACC1)",
    0x006B: "Gigi (ACC1)",
    0x006C: "Quillson (ACC1)",
    0x006D: "Marcie (ACC1)",
    0x006E: "Puck (ACC1)",
    0x006F: "Shari (ACC1)",
    0x0070: "Octavian (ACC1)",
    0x0071: "Winnie (ACC1)",
    0x0072: "Knox (ACC1)",
    0x0073: "Sterling (ACC1)",
    0x0074: "Bonbon (ACC1)",
    0x0075: "Punchy (ACC1)",
    0x0076: "Opal (ACC1)",
    0x0077: "Poppy (ACC1)",
    0x0078: "Limberg (ACC1)",
    0x0079: "Deena (ACC1)",
    0x007A: "Snake (ACC1)",
    0x007B: "Bangle (ACC1)",
    0x007C: "Phil (ACC1)",
    0x007D: "Monique (ACC1)",
    0x007E: "Nate (ACC1)",
    0x007F: "Samson (ACC1)",
    0x0080: "Tutu (ACC1)",
    0x0081: "T-Bone (ACC1)",
    0x0082: "Mint (ACC1)",
    0x0083: "Pudge (ACC1)",
    0x0084: "Midge (ACC1)",
    0x0085: "Gruff (ACC1)",
    0x0086: "Flurry (ACC1)",
    0x0087: "Clyde (ACC1)",
    0x0088: "Bella (ACC1)",
    0x0089: "Biff (ACC1)",
    0x008A: "Yuka (ACC1)",
    0x008B: "Lionel (ACC1)",
    0x008C: "Flo (ACC1)",
    0x008D: "Cobb (ACC1)",
    0x008E: "Amelia (ACC1)",
    0x008F: "Jeremiah (ACC1)",
    0x0090: "Cherry (ACC1)",
    0x0091: "Roscoe (ACC1)",
    0x0092: "Truffles (ACC1)",
    0x0093: "Eugene (ACC1)",
    0x0094: "Eunice (ACC1)",
    0x0095: "Goose (ACC1)",
    0x0096: "Annalisa (ACC1)",
    0x0097: "Benjamin (ACC1)",
    0x0098: "Pancetti (ACC1)",
    0x0099: "Chief (ACC1)",
    0x009A: "Bunnie (ACC1)",
    0x009B: "Clay (ACC1)",
    0x009C: "Diana (ACC1)",
    0x009D: "Axel (ACC1)",
    0x009E: "Muffy (ACC1)",
    0x009F: "Henry (ACC1)",
    0x00A0: "Bertha (ACC1)",
    0x00A1: "Cyrano (ACC1)",
    0x00A2: "Peanut (ACC1)",
    0x00A3: "Cole (ACC1)",
    0x00A4: "Willow (ACC1)",
    0x00A5: "Roald (ACC1)",
    0x00A6: "Molly (ACC1)",
    0x00A7: "Walker (ACC1)",
    0x00A8: "K.K. Slider (ACC2)",
    0x00A9: "Reese (ACC2)",
    0x00AA: "Kicks (ACC2)",
    0x00AB: "Labelle (ACC2)",
    0x00AC: "Copper (ACC2)",
    0x00AD: "Booker (ACC2)",
    0x00AE: "Katie (ACC2)",
    0x00AF: "Tommy (ACC2)",
    0x00B0: "Porter (ACC2)",
    0x00B1: "Leila (ACC2)",
    0x00B2: "Dr. Shrunk (ACC2)",
    0x00B3: "Don Resetti (ACC2)",
    0x00B4: "Isabelle (ACC2)",
    0x00B5: "Blanca (ACC2)",
    0x00B6: "Nat (ACC2)",
    0x00B7: "Chip (ACC2)",
    0x00B8: "Jack (ACC2)",
    0x00B9: "Poncho (ACC2)",
    0x00BA: "Felicity (ACC2)",
    0x00BB: "Ozzie (ACC2)",
    0x00BC: "Tia (ACC2)",
    0x00BD: "Lucha (ACC2)",
    0x00BE: "Fuchsia (ACC2)",
    0x00BF: "Harry (ACC2)",
    0x00C0: "Gwen (ACC2)",
    0x00C1: "Coach (ACC2)",
    0x00C2: "Kitt (ACC2)",
    0x00C3: "Tom (ACC2)",
    0x00C4: "Tipper (ACC2)",
    0x00C5: "Prince (ACC2)",
    0x00C6: "Pate (ACC2)",
    0x00C7: "Vladimir (ACC2)",
    0x00C8: "Savannah (ACC2)",
    0x00C9: "Kidd (ACC2)",
    0x00CA: "Phoebe (ACC2)",
    0x00CB: "Egbert (ACC2)",
    0x00CC: "Cookie (ACC2)",
    0x00CD: "Sly (ACC2)",
    0x00CE: "Blaire (ACC2)",
    0x00CF: "Avery (ACC2)",
    0x00D0: "Nana (ACC2)",
    0x00D1: "Peck (ACC2)",
    0x00D2: "Olivia (ACC2)",
    0x00D3: "Cesar (ACC2)",
    0x00D4: "Carmen (ACC2)",
    0x00D5: "Rodney (ACC2)",
    0x00D6: "Scoot (ACC2)",
    0x00D7: "Whitney (ACC2)",
    0x00D8: "Broccolo (ACC2)",
    0x00D9: "Coco (ACC2)",
    0x00DA: "Groucho (ACC2)",
    0x00DB: "Wendy (ACC2)",
    0x00DC: "Alfonso (ACC2)",
    0x00DD: "Rhonda (ACC2)",
    0x00DE: "Butch (ACC2)",
    0x00DF: "Gabi (ACC2)",
    0x00E0: "Moose (ACC2)",
    0x00E1: "Timbra (ACC2)",
    0x00E2: "Zell (ACC2)",
    0x00E3: "Pekoe (ACC2)",
    0x00E4: "Teddy (ACC2)",
    0x00E5: "Mathilda (ACC2)",
    0x00E6: "Ed (ACC2)",
    0x00E7: "Bianca (ACC2)",
    0x00E8: "Filbert (ACC2)",
    0x00E9: "Kitty (ACC2)",
    0x00EA: "Beau (ACC2)",
    0x00EB: "Nan (ACC2)",
    0x00EC: "Bud (ACC2)",
    0x00ED: "Ruby (ACC2)",
    0x00EE: "Benedict (ACC2)",
    0x00EF: "Agnes (ACC2)",
    0x00F0: "Julian (ACC2)",
    0x00F1: "Bettina (ACC2)",
    0x00F2: "Jay (ACC2)",
    0x00F3: "Sprinkle (ACC2)",
    0x00F4: "Flip (ACC2)",
    0x00F5: "Hugh (ACC2)",
    0x00F6: "Hopper (ACC2)",
    0x00F7: "Pecan (ACC2)",
    0x00F8: "Drake (ACC2)",
    0x00F9: "Alice (ACC2)",
    0x00FA: "Camofrog (ACC2)",
    0x00FB: "Anicotti (ACC2)",
    0x00FC: "Chops (ACC2)",
    0x00FD: "Charlise (ACC2)",
    0x00FE: "Vic (ACC2)",
    0x00FF: "Ankha (ACC2)",
    0x0100: "Drift (ACC2)",
    0x0101: "Vesta (ACC2)",
    0x0102: "Marcel (ACC2)",
    0x0103: "Pango (ACC2)",
    0x0104: "Keaton (ACC2)",
    0x0105: "Gladys (ACC2)",
    0x0106: "Hamphrey (ACC2)",
    0x0107: "Freya (ACC2)",
    0x0108: "Kid Cat (ACC2)",
    0x0109: "Agent S (ACC2)",
    0x010A: "Big Top (ACC2)",
    0x010B: "Rocket (ACC2)",
    0x010C: "Rover (ACC3)",
    0x010D: "Blathers (ACC3)",
    0x010E: "Tom Nook (ACC3)",
    0x010F: "Pelly (ACC3)",
    0x0110: "Phyllis (ACC3)",
    0x0111: "Pete (ACC3)",
    0x0112: "Mabel (ACC3)",
    0x0113: "Leif (ACC3)",
    0x0114: "Wendell (ACC3)",
    0x0115: "Cyrus (ACC3)",
    0x0116: "Grams (ACC3)",
    0x0117: "Timmy (ACC3)",
    0x0118: "Digby (ACC3)",
    0x0119: "Don Resetti (ACC3)",
    0x011A: "Isabelle (ACC3)",
    0x011B: "Franklin (ACC3)",
    0x011C: "Jingle (ACC3)",
    0x011D: "Lily (ACC3)",
    0x011E: "Anchovy (ACC3)",
    0x011F: "Tabby (ACC3)",
    0x0120: "Kody (ACC3)",
    0x0121: "Miranda (ACC3)",
    0x0122: "Del (ACC3)",
    0x0123: "Paula (ACC3)",
    0x0124: "Ken (ACC3)",
    0x0125: "Mitzi (ACC3)",
    0x0126: "Rodeo (ACC3)",
    0x0127: "Bubbles (ACC3)",
    0x0128: "Cousteau (ACC3)",
    0x0129: "Velma (ACC3)",
    0x012A: "Elvis (ACC3)",
    0x012B: "Canberra (ACC3)",
    0x012C: "Colton (ACC3)",
    0x012D: "Marina (ACC3)",
    0x012E: "Spork/Crackle (ACC3)",
    0x012F: "Freckles (ACC3)",
    0x0130: "Bam (ACC3)",
    0x0131: "Friga (ACC3)",
    0x0132: "Ricky (ACC3)",
    0x0133: "Deirdre (ACC3)",
    0x0134: "Hans (ACC3)",
    0x0135: "Chevre (ACC3)",
    0x0136: "Drago (ACC3)",
    0x0137: "Tangy (ACC3)",
    0x0138: "Mac (ACC3)",
    0x0139: "Eloise (ACC3)",
    0x013A: "Wart Jr. (ACC3)",
    0x013B: "Hazel (ACC3)",
    0x013C: "Beardo (ACC3)",
    0x013D: "Ava (ACC3)",
    0x013E: "Chester (ACC3)",
    0x013F: "Merry (ACC3)",
    0x0140: "Genji (ACC3)",
    0x0141: "Greta (ACC3)",
    0x0142: "Wolfgang (ACC3)",
    0x0143: "Diva (ACC3)",
    0x0144: "Klaus (ACC3)",
    0x0145: "Daisy (ACC3)",
    0x0146: "Stinky (ACC3)",
    0x0147: "Tammi (ACC3)",
    0x0148: "Tucker (ACC3)",
    0x0149: "Blanche (ACC3)",
    0x014A: "Gaston (ACC3)",
    0x014B: "Marshal (ACC3)",
    0x014C: "Gala (ACC3)",
    0x014D: "Joey (ACC3)",
    0x014E: "Pippy (ACC3)",
    0x014F: "Buck (ACC3)",
    0x0150: "Bree (ACC3)",
    0x0151: "Rooney (ACC3)",
    0x0152: "Curlos (ACC3)",
    0x0153: "Skye (ACC3)",
    0x0154: "Moe (ACC3)",
    0x0155: "Flora (ACC3)",
    0x0156: "Hamlet (ACC3)",
    0x0157: "Astrid (ACC3)",
    0x0158: "Monty (ACC3)",
    0x0159: "Dora (ACC3)",
    0x015A: "Biskit (ACC3)",
    0x015B: "Victoria (ACC3)",
    0x015C: "Lyman (ACC3)",
    0x015D: "Violet (ACC3)",
    0x015E: "Frank (ACC3)",
    0x015F: "Chadder (ACC3)",
    0x0160: "Merengue (ACC3)",
    0x0161: "Cube (ACC3)",
    0x0162: "Claudia (ACC3)",
    0x0163: "Curly (ACC3)",
    0x0164: "Boomer (ACC3)",
    0x0165: "Caroline (ACC3)",
    0x0166: "Sparro (ACC3)",
    0x0167: "Baabara (ACC3)",
    0x0168: "Rolf (ACC3)",
    0x0169: "Maple (ACC3)",
    0x016A: "Antonio (ACC3)",
    0x016B: "Soleil (ACC3)",
    0x016C: "Apollo (ACC3)",
    0x016D: "Derwin (ACC3)",
    0x016E: "Francine (ACC3)",
    0x016F: "Chrissy (ACC3)",
    0x0170: "Isabelle (ACC4)",
    0x0171: "Brewster (ACC4)",
    0x0172: "Katrina (ACC4)",
    0x0173: "Phineas (ACC4)",
    0x0174: "Celeste (ACC4)",
    0x0175: "Tommy (ACC4)",
    0x0176: "Gracie (ACC4)",
    0x0177: "Leilani (ACC4)",
    0x0178: "Resetti (ACC4)",
    0x0179: "Timmy (ACC4)",
    0x017A: "Lottie (ACC4)",
    0x017B: "Shrunk (ACC4)",
    0x017C: "Pave (ACC4)",
    0x017D: "Gulliver (ACC4)",
    0x017E: "Redd (ACC4)",
    0x017F: "Zipper (ACC4)",
    0x0180: "Goldie (ACC4)",
    0x0181: "Stitches (ACC4)",
    0x0182: "Pinky (ACC4)",
    0x0183: "Mott (ACC4)",
    0x0184: "Mallary (ACC4)",
    0x0185: "Rocco (ACC4)",
    0x0186: "Katt (ACC4)",
    0x0187: "Graham (ACC4)",
    0x0188: "Peaches (ACC4)",
    0x0189: "Dizzy (ACC4)",
    0x018A: "Penelope (ACC4)",
    0x018B: "Boone (ACC4)",
    0x018C: "Broffina (ACC4)",
    0x018D: "Croque (ACC4)",
    0x018E: "Pashmina (ACC4)",
    0x018F: "Shep (ACC4)",
    0x0190: "Lolly (ACC4)",
    0x0191: "Erik (ACC4)",
    0x0192: "Dotty (ACC4)",
    0x0193: "Pierce (ACC4)",
    0x0194: "Queenie (ACC4)",
    0x0195: "Fang (ACC4)",
    0x0196: "Frita (ACC4)",
    0x0197: "Tex (ACC4)",
    0x0198: "Melba (ACC4)",
    0x0199: "Bones (ACC4)",
    0x019A: "Anabelle (ACC4)",
    0x019B: "Rudy (ACC4)",
    0x019C: "Naomi (ACC4)",
    0x019D: "Peewee (ACC4)",
    0x019E: "Tammy (ACC4)",
    0x019F: "Olaf (ACC4)",
    0x01A0: "Lucy (ACC4)",
    0x01A1: "Elmer (ACC4)",
    0x01A2: "Puddles (ACC4)",
    0x01A3: "Rory (ACC4)",
    0x01A4: "Elise (ACC4)",
    0x01A5: "Walt (ACC4)",
    0x01A6: "Mira (ACC4)",
    0x01A7: "Pietro (ACC4)",
    0x01A8: "Aurora (ACC4)",
    0x01A9: "Papi (ACC4)",
    0x01AA: "Apple (ACC4)",
    0x01AB: "Rod (ACC4)",
    0x01AC: "Purrl (ACC4)",
    0x01AD: "Static (ACC4)",
    0x01AE: "Celia (ACC4)",
    0x01AF: "Zucker (ACC4)",
    0x01B0: "Peggy (ACC4)",
    0x01B1: "Ribbot (ACC4)",
    0x01B2: "Annalise (ACC4)",
    0x01B3: "Chow (ACC4)",
    0x01B4: "Sylvia (ACC4)",
    0x01B5: "Jacques (ACC4)",
    0x01B6: "Sally (ACC4)",
    0x01B7: "Doc (ACC4)",
    0x01B8: "Pompom (ACC4)",
    0x01B9: "Tank (ACC4)",
    0x01BA: "Becky (ACC4)",
    0x01BB: "Rizzo (ACC4)",
    0x01BC: "Sydney (ACC4)",
    0x01BD: "Barold (ACC4)",
    0x01BE: "Nibbles (ACC4)",
    0x01BF: "Kevin (ACC4)",
    0x01C0: "Gloria (ACC4)",
    0x01C1: "Lobo (ACC4)",
    0x01C2: "Hippeux (ACC4)",
    0x01C3: "Margie (ACC4)",
    0x01C4: "Lucky (ACC4)",
    0x01C5: "Rosie (ACC4)",
    0x01C6: "Rowan (ACC4)",
    0x01C7: "Maelle (ACC4)",
    0x01C8: "Bruce (ACC4)",
    0x01C9: "O'Hare (ACC4)",
    0x01CA: "Gayle (ACC4)",
    0x01CB: "Cranston (ACC4)",
    0x01CC: "Frobert (ACC4)",
    0x01CD: "Grizzly (ACC4)",
    0x01CE: "Cally (ACC4)",
    0x01CF: "Simon (ACC4)",
    0x01D0: "Iggly (ACC4)",
    0x01D1: "Angus (ACC4)",
    0x01D2: "Twiggy (ACC4)",
    0x01D3: "Robin (ACC4)",
    0x01D4: "Isabelle Promo (ACCP)",
    0x01D5: "Goldie (ACCP)",
    0x01D6: "Stitches (ACCP)",
    0x01D7: "Rosie (ACCP)",
    0x01D8: "K.K. Slider (ACCP)",
    0x0238: "Mario Classic Colors (3AM)",
    0x0239: "Mario Modern Colors (3AM)",
    0x023A: "Dark Hammer Slam Bowser (SKL)",
    0x023B: "Dark Turbo Charge Donkey Kong (SKL)",
    0x023D: "Mewtwo (SSB)",
    0x023E: "Mega Yarn Yoshi (YWW)",
    0x023F: "Isabelle (ACF)",
    0x0240: "K.K. Slider (ACF)",
    0x0241: "Mabel (ACF)",
    0x0242: "Tom Nook (ACF)",
    0x0243: "Digby (ACF)",
    0x0244: "Lottie (ACF)",
    0x0245: "Reese (ACF)",
    0x0246: "Cyrus (ACF)",
    0x0247: "Blathers (ACF)",
    0x0248: "Celeste (ACF)",
    0x0249: "Resetti (ACF)",
    0x024A: "Kicks (ACF)",
    0x024B: "Isabelle (Summer Outfit) (ACF)",
    0x024C: "Rover (ACF)",
    0x024D: "Timmy & Tommy (ACF)",
    0x024E: "Kapp'n (ACF)",
    0x024F: "Wolf Link (Twilight Princess) (LOZ)",
    0x0250: "Shovel Knight (SHK)",
    0x0251: "Lucas (SSB)",
    0x0252: "Roy (SSB)",
    0x0253: "Ryu (SSB)",
    0x0254: "Kirby (KIR)",
    0x0255: "Meta Knight (KIR)",
    0x0256: "King Dedede (KIR)",
    0x0257: "Waddle Dee (KIR)",
    0x0258: "Mega Man (Gold Edition) (SSB)",
    0x025C: "Shadow Mewtwo (POK)",
    0x025D: "Callie (SPL)",
    0x025E: "Marie (SPL)",
    0x025F: "Inkling Girl (Lime Green) (SPL)",
    0x0260: "Inkling Boy (Purple) (SPL)",
    0x0261: "Inkling Squid (Orange) (SPL)",
    0x0262: "Rosalina (SMB)",
    0x0263: "Wario (SMB)",
    0x0264: "Donkey Kong (SMB)",
    0x0265: "Diddy Kong (SMB)",
    0x0266: "Daisy (SMB)",
    0x0267: "Waluigi (SMB)",
    0x0268: "Boo (SMB)",
    0x02E1: "One-Eyed Rathalos and Rider (Male) (MON)",
    0x02E2: "One-Eyed Rathalos and Rider (Female) (MON)",
    0x02E3: "Nabiru (MON)",
    0x02E4: "Rathian and Cheval (MON)",
    0x02E5: "Barioth and Ayuria (MON)",
    0x02E6: "Qurupeco and Dan (MON)",
    0x02E7: "Vivian (ACCW)",
    0x02E8: "Hopkins (ACCW)",
    0x02E9: "June (ACCW)",
    0x02EA: "Piper (ACCW)",
    0x02EB: "Paolo (ACCW)",
    0x02EC: "Hornsby (ACCW)",
    0x02ED: "Stella (ACCW)",
    0x02EE: "Tybalt (ACCW)",
    0x02EF: "Huck (ACCW)",
    0x02F0: "Sylvana (ACCW)",
    0x02F1: "Boris (ACCW)",
    0x02F2: "Wade (ACCW)",
    0x02F3: "Carrie (ACCW)",
    0x02F4: "Ketchup (ACCW)",
    0x02F5: "Rex (ACCW)",
    0x02F6: "Stu (ACCW)",
    0x02F7: "Ursala (ACCW)",
    0x02F8: "Jacob (ACCW)",
    0x02F9: "Maddie (ACCW)",
    0x02FA: "Billy (ACCW)",
    0x02FB: "Boyd (ACCW)",
    0x02FC: "Bitty (ACCW)",
    0x02FD: "Maggie (ACCW)",
    0x02FE: "Murphy (ACCW)",
    0x02FF: "Plucky (ACCW)",
    0x0300: "Sandy (ACCW)",
    0x0301: "Claude (ACCW)",
    0x0302: "Raddle (ACCW)",
    0x0303: "Julia (ACCW)",
    0x0304: "Louie (ACCW)",
    0x0305: "Bea (ACCW)",
    0x0306: "Admiral (ACCW)",
    0x0307: "Ellie (ACCW)",
    0x0308: "Boots (ACCW)",
    0x0309: "Weber (ACCW)",
    0x030A: "Candi (ACCW)",
    0x030B: "Leopold (ACCW)",
    0x030C: "Spike (ACCW)",
    0x030D: "Cashmere (ACCW)",
    0x030E: "Tad (ACCW)",
    0x030F: "Norma (ACCW)",
    0x0310: "Gonzo (ACCW)",
    0x0311: "Sprocket (ACCW)",
    0x0312: "Snooty (ACCW)",
    0x0313: "Olive (ACCW)",
    0x0314: "Dobie (ACCW)",
    0x0315: "Buzz (ACCW)",
    0x0316: "Cleo (ACCW)",
    0x0317: "Ike (ACCW)",
    0x0318: "Tasha (ACCW)",
    0x0319: "Rilla (ACCS)",
    0x031A: "Marty (ACCS)",
    0x031B: "Étoile (ACCS)",
    0x031C: "Chai (ACCS)",
    0x031D: "Chelsea (ACCS)",
    0x031E: "Toby (ACCS)",
    0x034B: "Link (Ocarina of Time) (LOZ)",
    0x034D: "Link (Twilight Princess) (LOZ)",
    0x034F: "8-bit Link (The Legend of Zelda) (LOZ)",
    0x0350: "Toon Link (The Wind Waker) (LOZ)",
    0x0352: "Toon Zelda (The Wind Waker) (LOZ)",
    0x0353: "Archer Link (The Breath of Wild) (LOZ)",
    0x0354: "Rider Link (The Breath of Wild) (LOZ)",
    0x034E: "Link (Skyward Sword) (LOZ)",
    0x034C: "Link (Majora's Mask) (LOZ)",
    0x0355: "Guardian (Breath of the Wild) (LOZ)",
    0x0356: "Zelda (Breath of the Wild) (LOZ)",
    0x035C: "Bokoblin (Breath of the Wild) (LOZ)",
}


CHAR_MAP = {
    0x00000000: "Mario",
    0x00000100: "Dr. Mario",
    0x00010000: "Luigi",
    0x00020000: "Peach",
    0x00030000: "Yoshi",
    0x00030102: "Mega Yarn Yoshi",
    0x00040000: "Rosalina",
    0x00040100: "Rosalina and Luma",
    0x00050000: "Bowser",
    0x0005FF00: "Dark Hammer Slam Bowser",
    0x00060000: "Bowser Jr.",
    0x00070000: "Wario",
    0x00080000: "Donkey Kong",
    0x0008FF00: "Dark Turbo Charge Donkey Kong",
    0x00090000: "Diddy Kong",
    0x000A0000: "Toad",
    0x00130000: "Daisy",
    0x00140000: "Waluigi",
    0x00170000: "Boo",
    0x01000000: "Link",
    0x01000100: "Toon Link",
    0x01010000: "Zelda",
    0x01010100: "Sheik",
    0x01020100: "Ganondorf",
    0x01030000: "Wolf Link",
    0x01400000: "Guardian",
    0x01410000: "Bokoblin",
    0x01800000: "Villager",
    0x01810000: "Isabelle (Summer Outfit)",
    0x01810001: "Isabelle",
    0x01810100: "Isabelle",
    0x01810101: "Isabelle",
    0x01810201: "Isabelle",
    0x01810301: "Isabelle",
    0x01820000: "K.K. Slider",
    0x01820001: "K.K. Slider",
    0x01820101: "DJ K.K.",
    0x01830000: "Tom Nook",
    0x01830001: "Tom Nook",
    0x01830101: "Tom Nook",
    0x01840000: "Timmy & Tommy",
    0x01850001: "Timmy",
    0x01850201: "Timmy",
    0x01850401: "Timmy",
    0x01860101: "Tommy",
    0x01860301: "Tommy",
    0x01870001: "Sable",
    0x01880000: "Mabel",
    0x01880001: "Mabel",
    0x01890001: "Labelle",
    0x018A0000: "Reese",
    0x018A0001: "Reese",
    0x018B0000: "Cyrus",
    0x018B0001: "Cyrus",
    0x018C0000: "Digby",
    0x018C0001: "Digby",
    0x018C0101: "Digby",
    0x018D0000: "Rover",
    0x018D0001: "Rover",
    0x018E0000: "Resetti",
    0x018E0001: "Resetti",
    0x018E0101: "Resetti",
    0x018F0001: "Don Resetti",
    0x018F0101: "Don Resetti",
    0x01900001: "Brewster",
    0x01910001: "Harriet",
    0x01920000: "Blathers",
    0x01920001: "Blathers",
    0x01930000: "Celeste",
    0x01930001: "Celeste",
    0x01940000: "Kicks",
    0x01940001: "Kicks",
    0x01950001: "Porter",
    0x01960000: "Kapp'n",
    0x01960001: "Kappn",
    0x01970001: "Leilani",
    0x01980001: "Leila",
    0x01990001: "Grams",
    0x019A0001: "Chip",
    0x019B0001: "Nat",
    0x019C0001: "Phineas",
    0x019D0001: "Copper",
    0x019E0001: "Booker",
    0x019F0001: "Pete",
    0x01A00001: "Pelly",
    0x01A10001: "Phyllis",
    0x01A20001: "Gulliver",
    0x01A30001: "Joan",
    0x01A40001: "Pascal",
    0x01A50001: "Katrina",
    0x01A60001: "Saharah",
    0x01A70001: "Wendell",
    0x01A80001: "Redd",
    0x01A80101: "Redd",
    0x01A90001: "Gracie",
    0x01AA0001: "Lyle",
    0x01AB0001: "Pave",
    0x01AC0001: "Zipper",
    0x01AD0001: "Jack",
    0x01AE0001: "Franklin",
    0x01AF0001: "Jingle",
    0x01B00001: "Tortimer",
    0x01B10001: "Dr. Shrunk",
    0x01B10101: "Shrunk",
    0x01B30001: "Blanca",
    0x01B40001: "Leif",
    0x01B50001: "Luna",
    0x01B60001: "Katie",
    0x01C10000: "Lottie",
    0x01C10001: "Lottie",
    0x01C10101: "Lottie",
    0x02000001: "Cyrano",
    0x02010001: "Antonio",
    0x02020001: "Pango",
    0x02030001: "Anabelle",
    0x02060001: "Snooty",
    0x02080001: "Annalisa",
    0x02090001: "Olaf",
    0x02140001: "Teddy",
    0x02150001: "Pinky",
    0x02160001: "Curt",
    0x02170001: "Chow",
    0x02190001: "Nate",
    0x021A0001: "Groucho",
    0x021B0001: "Tutu",
    0x021C0001: "Ursala",
    0x021D0001: "Grizzly",
    0x021E0001: "Paula",
    0x021F0001: "Ike",
    0x02200001: "Charlise",
    0x02210001: "Beardo",
    0x02220001: "Klaus",
    0x022D0001: "Jay",
    0x022E0001: "Robin",
    0x022F0001: "Anchovy",
    0x02300001: "Twiggy",
    0x02310001: "Jitters",
    0x02320001: "Piper",
    0x02330001: "Admiral",
    0x02350001: "Midge",
    0x02380001: "Jacob",
    0x023C0001: "Lucha",
    0x023D0001: "Jacques",
    0x023E0001: "Peck",
    0x023F0001: "Sparro",
    0x024A0001: "Angus",
    0x024B0001: "Rodeo",
    0x024D0001: "Stu",
    0x024F0001: "T-Bone",
    0x02510001: "Coach",
    0x02520001: "Vic",
    0x025D0001: "Bob",
    0x025E0001: "Mitzi",
    0x025F0001: "Rosie",
    0x02600001: "Olivia",
    0x02610001: "Kiki",
    0x02620001: "Tangy",
    0x02630001: "Punchy",
    0x02640001: "Purrl",
    0x02650001: "Moe",
    0x02660001: "Kabuki",
    0x02670001: "Kid Cat",
    0x02680001: "Monique",
    0x02690001: "Tabby",
    0x026A0001: "Stinky",
    0x026B0001: "Kitty",
    0x026C0001: "Tom",
    0x026D0001: "Merry",
    0x026E0001: "Felicity",
    0x026F0001: "Lolly",
    0x02700001: "Ankha",
    0x02710001: "Rudy",
    0x02720001: "Katt",
    0x027D0001: "Bluebear",
    0x027E0001: "Maple",
    0x027F0001: "Poncho",
    0x02800001: "Pudge",
    0x02810001: "Kody",
    0x02820001: "Stitches",
    0x02830001: "Vladimir",
    0x02840001: "Murphy",
    0x02860001: "Olive",
    0x02870001: "Cheri",
    0x028A0001: "June",
    0x028B0001: "Pekoe",
    0x028C0001: "Chester",
    0x028D0001: "Barold",
    0x028E0001: "Tammy",
    0x028F0101: "Marty",
    0x02990001: "Goose",
    0x029A0001: "Benedict",
    0x029B0001: "Egbert",
    0x029E0001: "Ava",
    0x02A20001: "Becky",
    0x02A30001: "Plucky",
    0x02A40001: "Knox",
    0x02A50001: "Broffina",
    0x02A60001: "Ken",
    0x02B10001: "Patty",
    0x02B20001: "Tipper",
    0x02B70001: "Norma",
    0x02B80001: "Naomi",
    0x02C30001: "Alfonso",
    0x02C40001: "Alli",
    0x02C50001: "Boots",
    0x02C70001: "Del",
    0x02C90001: "Sly",
    0x02CA0001: "Gayle",
    0x02CB0001: "Drago",
    0x02D60001: "Fauna",
    0x02D70001: "Bam",
    0x02D80001: "Zell",
    0x02D90001: "Bruce",
    0x02DA0001: "Deirdre",
    0x02DB0001: "Lopez",
    0x02DC0001: "Fuchsia",
    0x02DD0001: "Beau",
    0x02DE0001: "Diana",
    0x02DF0001: "Erik",
    0x02E00101: "Chelsea",
    0x02EA0001: "Goldie",
    0x02EB0001: "Butch",
    0x02EC0001: "Lucky",
    0x02ED0001: "Biskit",
    0x02EE0001: "Bones",
    0x02EF0001: "Portia",
    0x02F00001: "Walker",
    0x02F10001: "Daisy",
    0x02F20001: "Cookie",
    0x02F30001: "Maddie",
    0x02F40001: "Bea",
    0x02F80001: "Mac",
    0x02F90001: "Marcel",
    0x02FA0001: "Benjamin",
    0x02FB0001: "Cherry",
    0x02FC0001: "Shep",
    0x03070001: "Bill",
    0x03080001: "Joey",
    0x03090001: "Pate",
    0x030A0001: "Maelle",
    0x030B0001: "Deena",
    0x030C0001: "Pompom",
    0x030D0001: "Mallary",
    0x030E0001: "Freckles",
    0x030F0001: "Derwin",
    0x03100001: "Drake",
    0x03110001: "Scoot",
    0x03120001: "Weber",
    0x03130001: "Miranda",
    0x03140001: "Ketchup",
    0x03160001: "Gloria",
    0x03170001: "Molly",
    0x03180001: "Quillson",
    0x03230001: "Opal",
    0x03240001: "Dizzy",
    0x03250001: "Big Top",
    0x03260001: "Eloise",
    0x03270001: "Margie",
    0x03280001: "Paolo",
    0x03290001: "Axel",
    0x032A0001: "Ellie",
    0x032C0001: "Tucker",
    0x032D0001: "Tia",
    0x032E0101: "Chai",
    0x03380001: "Lily",
    0x03390001: "Ribbot",
    0x033A0001: "Frobert",
    0x033B0001: "Camofrog",
    0x033C0001: "Drift",
    0x033D0001: "Wart Jr.",
    0x033E0001: "Puddles",
    0x033F0001: "Jeremiah",
    0x03410001: "Tad",
    0x03420001: "Cousteau",
    0x03430001: "Huck",
    0x03440001: "Prince",
    0x03450001: "Jambette",
    0x03470001: "Raddle",
    0x03480001: "Gigi",
    0x03490001: "Croque",
    0x034A0001: "Diva",
    0x034B0001: "Henry",
    0x03560001: "Chevre",
    0x03570001: "Nan",
    0x03580001: "Billy",
    0x035A0001: "Gruff",
    0x035C0001: "Velma",
    0x035D0001: "Kidd",
    0x035E0001: "Pashmina",
    0x03690001: "Cesar",
    0x036A0001: "Peewee",
    0x036B0001: "Boone",
    0x036D0001: "Louie",
    0x036E0001: "Boyd",
    0x03700001: "Violet",
    0x03710001: "Al",
    0x03720001: "Rocket",
    0x03730001: "Hans",
    0x03740101: "Rilla",
    0x037E0001: "Hamlet",
    0x037F0001: "Apple",
    0x03800001: "Graham",
    0x03810001: "Rodney",
    0x03820001: "Soleil",
    0x03830001: "Clay",
    0x03840001: "Flurry",
    0x03850001: "Hamphrey",
    0x03900001: "Rocco",
    0x03920001: "Bubbles",
    0x03930001: "Bertha",
    0x03940001: "Biff",
    0x03950001: "Bitty",
    0x03980001: "Harry",
    0x03990001: "Hippeux",
    0x03A40001: "Buck",
    0x03A50001: "Victoria",
    0x03A60001: "Savannah",
    0x03A70001: "Elmer",
    0x03A80001: "Roscoe",
    0x03A90001: "Winnie",
    0x03AA0001: "Ed",
    0x03AB0001: "Cleo",
    0x03AC0001: "Peaches",
    0x03AD0001: "Annalise",
    0x03AE0001: "Clyde",
    0x03AF0001: "Colton",
    0x03B00001: "Papi",
    0x03B10001: "Julian",
    0x03BC0001: "Yuka",
    0x03BD0001: "Alice",
    0x03BE0001: "Melba",
    0x03BF0001: "Sydney",
    0x03C00001: "Gonzo",
    0x03C10001: "Ozzie",
    0x03C40001: "Canberra",
    0x03C50001: "Lyman",
    0x03C60001: "Eugene",
    0x03D10001: "Kitt",
    0x03D20001: "Mathilda",
    0x03D30001: "Carrie",
    0x03D60001: "Astrid",
    0x03D70001: "Sylvia",
    0x03D90001: "Walt",
    0x03DA0001: "Rooney",
    0x03DB0001: "Marcie",
    0x03E60001: "Bud",
    0x03E70001: "Elvis",
    0x03E80001: "Rex",
    0x03EA0001: "Leopold",
    0x03EC0001: "Mott",
    0x03ED0001: "Rory",
    0x03EE0001: "Lionel",
    0x03FA0001: "Nana",
    0x03FB0001: "Simon",
    0x03FC0001: "Tammi",
    0x03FD0001: "Monty",
    0x03FE0001: "Elise",
    0x03FF0001: "Flip",
    0x04000001: "Shari",
    0x04010001: "Deli",
    0x040C0001: "Dora",
    0x040D0001: "Limberg",
    0x040E0001: "Bella",
    0x040F0001: "Bree",
    0x04100001: "Samson",
    0x04110001: "Rod",
    0x04140001: "Candi",
    0x04150001: "Rizzo",
    0x04160001: "Anicotti",
    0x04180001: "Broccolo",
    0x041A0001: "Moose",
    0x041B0001: "Bettina",
    0x041C0001: "Greta",
    0x041D0001: "Penelope",
    0x041E0001: "Chadder",
    0x04290001: "Octavian",
    0x042A0001: "Marina",
    0x042B0001: "Zucker",
    0x04360001: "Queenie",
    0x04370001: "Gladys",
    0x04380001: "Sandy",
    0x04390001: "Sprocket",
    0x043B0001: "Julia",
    0x043C0001: "Cranston",
    0x043D0001: "Phil",
    0x043E0001: "Blanche",
    0x043F0001: "Flora",
    0x04400001: "Phoebe",
    0x044B0001: "Apollo",
    0x044C0001: "Amelia",
    0x044D0001: "Pierce",
    0x044E0001: "Buzz",
    0x04500001: "Avery",
    0x04510001: "Frank",
    0x04520001: "Sterling",
    0x04530001: "Keaton",
    0x04540001: "Celia",
    0x045F0001: "Aurora",
    0x04600001: "Roald",
    0x04610001: "Cube",
    0x04620001: "Hopper",
    0x04630001: "Friga",
    0x04640001: "Gwen",
    0x04650001: "Puck",
    0x04680001: "Wade",
    0x04690001: "Boomer",
    0x046A0001: "Iggly",
    0x046B0001: "Tex",
    0x046C0001: "Flo",
    0x046D0001: "Sprinkle",
    0x04780001: "Curly",
    0x04790001: "Truffles",
    0x047A0001: "Rasher",
    0x047B0001: "Hugh",
    0x047C0001: "Lucy",
    0x047D0001: "Spork/Crackle",
    0x04800001: "Cobb",
    0x04810001: "Boris",
    0x04820001: "Maggie",
    0x04830001: "Peggy",
    0x04850001: "Gala",
    0x04860001: "Chops",
    0x04870001: "Kevin",
    0x04880001: "Pancetti",
    0x04890001: "Agnes",
    0x04940001: "Bunnie",
    0x04950001: "Dotty",
    0x04960001: "Coco",
    0x04970001: "Snake",
    0x04980001: "Gaston",
    0x04990001: "Gabi",
    0x049A0001: "Pippy",
    0x049B0001: "Tiffany",
    0x049C0001: "Genji",
    0x049D0001: "Ruby",
    0x049E0001: "Doc",
    0x049F0001: "Claude",
    0x04A00001: "Francine",
    0x04A10001: "Chrissy",
    0x04A20001: "Hopkins",
    0x04A30001: "O'Hare",
    0x04A40001: "Carmen",
    0x04A50001: "Bonbon",
    0x04A60001: "Cole",
    0x04A70001: "Mira",
    0x04A80101: "Toby",
    0x04B20001: "Tank",
    0x04B30001: "Rhonda",
    0x04B40001: "Spike",
    0x04B60001: "Hornsby",
    0x04B90001: "Merengue",
    0x04BA0001: "Renée",
    0x04C50001: "Vesta",
    0x04C60001: "Baabara",
    0x04C70001: "Eunice",
    0x04C80001: "Stella",
    0x04C90001: "Cashmere",
    0x04CC0001: "Willow",
    0x04CD0001: "Curlos",
    0x04CE0001: "Wendy",
    0x04CF0001: "Timbra",
    0x04D00001: "Frita",
    0x04D10001: "Muffy",
    0x04D20001: "Pietro",
    0x04D30101: "Étoile",
    0x04DD0001: "Peanut",
    0x04DE0001: "Blaire",
    0x04DF0001: "Filbert",
    0x04E00001: "Pecan",
    0x04E10001: "Nibbles",
    0x04E20001: "Agent S",
    0x04E30001: "Caroline",
    0x04E40001: "Sally",
    0x04E50001: "Static",
    0x04E60001: "Mint",
    0x04E70001: "Ricky",
    0x04E80001: "Cally",
    0x04EA0001: "Tasha",
    0x04EB0001: "Sylvana",
    0x04EC0001: "Poppy",
    0x04ED0001: "Sheldon",
    0x04EE0001: "Marshal",
    0x04EF0001: "Hazel",
    0x04FA0001: "Rolf",
    0x04FB0001: "Rowan",
    0x04FC0001: "Tybalt",
    0x04FD0001: "Bangle",
    0x04FE0001: "Leonardo",
    0x04FF0001: "Claudia",
    0x05000001: "Bianca",
    0x050B0001: "Chief",
    0x050C0001: "Lobo",
    0x050D0001: "Wolfgang",
    0x050E0001: "Whitney",
    0x050F0001: "Dobie",
    0x05100001: "Freya",
    0x05110001: "Fang",
    0x05130001: "Vivian",
    0x05140001: "Skye",
    0x05150001: "Kyle",
    0x05800000: "Fox",
    0x05810000: "Falco",
    0x05C00000: "Samus",
    0x05C00100: "Zero Suit Samus",
    0x06000000: "Captain Falcon",
    0x06400100: "Olimar",
    0x06C00000: "Little Mac",
    0x07000000: "Wii Fit Trainer",
    0x07400000: "Pit",
    0x07410000: "Dark Pit",
    0x07420000: "Palutena",
    0x07800000: "Mr. Game & Watch",
    0x07810000: "R.O.B. (Famicom)",
    0x07820000: "Duck Hunt",
    0x07C00000: "Mii Brawler",
    0x07C00100: "Mii Swordfighter",
    0x07C00200: "Mii Gunner",
    0x08000100: "Inkling Girl (Lime Green)",
    0x08000200: "Inkling Boy (Purple)",
    0x08000300: "Inkling Squid (Orange)",
    0x08010000: "Callie",
    0x08020000: "Marie",
    0x19060000: "Charizard",
    0x19190000: "Pikachu",
    0x19270000: "Jigglypuff",
    0x19960000: "Mewtwo",
    0x1AC00000: "Lucario",
    0x1B920000: "Greninja",
    0x1D000001: "Shadow Mewtwo",
    0x1F000000: "Kirby",
    0x1F010000: "Meta Knight",
    0x1F020000: "King Dedede",
    0x1F030000: "Waddle Dee",
    0x21000000: "Marth",
    0x21010000: "Ike",
    0x21020000: "Lucina",
    0x21030000: "Robin",
    0x21040000: "Roy",
    0x21050000: "Corrin", #// TODO last two digits
    0x22400000: "Shulk",
    0x22800000: "Ness",
    0x22810000: "Lucas",
    0x22C00000: "Chibi-Robo",
    0x32000000: "Sonic",
    0x33400000: "Pac-Man",
    0x34800000: "Mega Man",
    0x34C00000: "Ryu",
    0x35000100: "One-Eyed Rathalos and Rider (Male)",
    0x35000200: "One-Eyed Rathalos and Rider (Female)",
    0x35010000: "Nabiru",
    0x35020100: "Rathian and Cheval",
    0x35030100: "Barioth and Ayuria",
    0x35040100: "Qurupeco and Dan",
    0x35C00000: "Shovel Knight",
    0x38400000: "Cloud Strife", #// TODO last two digits for this and next
    0x39800000: "Bayonetta",
}


def amii_decode(amiifile, data_key, tag_key):

    data = amiifile.read()

    data = data[:540]
    data = data + ((540 - len(data)) *b'\x00')

    seed = amii_seed(data)
    data_hmackey = amii_keygen(seed, data_key)
    tag_hmackey  = amii_keygen(seed, tag_key)

    #print_data('HMAC DATA KEY      :', data_hmackey, 0, len(data_hmackey))
    #print_data('HMAC TAG KEY       :', tag_hmackey, 0, len(tag_hmackey))

    m_data = hmac.new(key=data_hmackey[-16:],
                      msg=data[0x29:0x29+0x1DF],
                      digestmod=hashlib.sha256)
    m_tag  = hmac.new(key=tag_hmackey[-16:],
                      msg=data[0x1D4:0x1D4+0x34],
                      digestmod=hashlib.sha256)


    print_data('NTAG215 BCC1        :', data, 0, 1)
    print_data('NTAG215 INT         :', data, 1, 1)
    print_data('NTAG215 LOCK0-LOCK1 :', data, 2, 2)
    print_data('NTAG215 OPT0-OPT3   :', data, 4, 4)

    print_data('HMAC DATA x29(x1DF) :', data, 8, 32)
    print_data('HMAC DATA check     :', m_data.digest(), 0, m_data.digest_size)

    print_data('CONST  A5           :', data, 0x28, 1)
    print_sfmt('Number of Writes    :', data, 0x29, 2, '>H')

    print_data('UKNOWN              :', data, 0x2b, 1) # FIXME

    print_data('CFG Flags           :', data, 0x2c, 1)          #0x0 	0x1 	Flags. The low 4-bits here are copied to the struct used with NFC:GetAmiiboSettings. The below setup date is only loaded when bit4 and/or bit5 here are set, otherwise value 0 is used instead for the date. Bit4=1 indicates that the Amiibo was setup with amiibo Settings: NFC:GetAmiiboSettings will return an all-zero struct when this is not set. Bit5=1 indicates that the AppData was initialized. NFC:InitializeWriteAppData will return an error if this is value 1, when successful that command will then set this bit to value 1.
    print_data('Country Code ID     :', data, 0x2d, 1)          #0x1 	0x1 	Country Code ID, from the system which setup this amiibo. This is copied to the struct used with NFC:GetAmiiboSettings.
    print_sfmt('CRC32 update counter:', data, 0x2e, 2, '>H')    #0x2 	0x2 	This big-endian u16 counter is incremented each time that the CRC32 at offset 0x8 gets updated by NFC:InitializeWriteAppData, due to that value not matching the calculated one. When this value is already 0xFFFF, this counter won't be updated anymore.
    print_date('Date (first setup)  :', data, 0x30)             #0x4 	0x2 	u16 big-endian date value, see below. This is the date for when the Amiibo was initially setup in amiibo Settings. This is also written by NFC:InitializeWriteAppData.
    print_date('Date (last writen)  :', data, 0x32)             #0x6 	0x2 	u16 big-endian date value, see below. This is the date for when the Amiibo was last written to.
    print_data('CRC32 BE            :', data, 0x34, 4)          #0x8 	0x4 	Big-endian CRC32 value with initialval=~0, with the 8-byte output from Cfg:GenHashConsoleUnique. This is written by NFC:InitializeWriteAppData, when the current value doesn't match the calculated one.
    print_bdec('Amiibo Nickname     :', data, 0x38, 20, 'utf-16be')

    print_sfmt('Mii type & time     :', data, 0x4C, 4, '>L')
    print_data('Mii HMAC            :', data, 0x50, 4)
    print_data('Mii ID              :', data, 0x54, 4)
    print_data('Mii System ID       :', data, 0x58, 8)
    print_data('Mii LMAC            :', data, 0x60, 2)
    print_data('Mii padding         :', data, 0x62, 2)
    print_data('Mii Info 00         :', data, 0x64, 2)
    print_bdec('Mii Name            :', data, 0x66, 0x14, 'utf-16le')
    print_data('Mii Info 01         :', data, 0x7A, 0x1A)
    print_bdec('Mii Author Name     :', data, 0x94, 0x14, 'utf-16le')
    print_data('Mii unknown         :', data, 0xA8, 4)
    print_data('programID           :', data, 0xAC, 8)
    print_sfmt('Number of Writes    :', data, 0xB4, 2, '>H')
    print_data('AppID               :', data, 0xB6, 4)
    print_data('Unknown ?           :', data, 0xBA, 2)
    print_data('Unknown HMAC ?      :', data, 0xBC, 0x20)

    print_data('AppData             :', data, 0xDC, 0xD8)

    print_data('HMAC TAG x1D4(x34)  :', data, 0x1B4, 32)
    print_data('HMAC TAG check      :', m_tag.digest(), 0, m_tag.digest_size)

    print_data('NTAG215 UID0-UID2   :', data, 0x1D4, 3)
    print_data('NTAG215 BCC0        :', data, 0x1D7, 1)
    print_data('NTAG215 UID0-UID2   :', data, 0x1D8, 4)

    print_fmap('Char                :', data, 0x1DC, 4, '>L', CHAR_MAP)
    print_fmap('Id                  :', data, 0x1E0, 2, '>H', ID_MAP)
    print_fmap('Ser Name            :', data, 0x1E2, 2, '>H', SERNAME_MAP)


if __name__ == '__main__':
    import os
    import sys
    import argparse


    def _main():
        parser = argparse.ArgumentParser(prog=os.path.basename(sys.argv[0]),
                                         description='docx text extractor')

        parser.add_argument('-i', '--input',
                            dest='IFILE',
                            type=argparse.FileType('r+b'),
                            default=sys.stdin.buffer)


        parser.add_argument('-k', '--key',
                            type=argparse.FileType('r+b'),
                            dest='KEYFILE')

        args = parser.parse_args()


        key = args.KEYFILE.read()
        args.KEYFILE.close()

        data_key = key[:80]
        tag_key  = key[80:]

        amii_decode(amiifile = args.IFILE,
                    data_key = data_key,
                    tag_key = tag_key)

        if args.IFILE != sys.stdin.buffer:
            args.IFILE.close()

    _main()
